<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="会赢的">
<title>实习经历话术</title>

<link rel='canonical' href='https://LuciusWan.github.io/p/%E5%AE%9E%E4%B9%A0%E7%BB%8F%E5%8E%86%E8%AF%9D%E6%9C%AF/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="实习经历话术">
<meta property='og:description' content="会赢的">
<meta property='og:url' content='https://LuciusWan.github.io/p/%E5%AE%9E%E4%B9%A0%E7%BB%8F%E5%8E%86%E8%AF%9D%E6%9C%AF/'>
<meta property='og:site_name' content='LuciusWan'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2025-11-28T10:18:09&#43;08:00'/><meta property='article:modified_time' content='2025-11-28T10:18:09&#43;08:00'/>
<meta name="twitter:title" content="实习经历话术">
<meta name="twitter:description" content="会赢的">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_a00c4178710685fc.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🎇</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">LuciusWan</a></h1>
            <h2 class="site-description">欢迎来到我的blog</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/440554295'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/LuciusWan'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>友情链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#你是怎么设计你们的技术选型的">你是怎么设计你们的技术选型的</a>
      <ol>
        <li>
          <ol>
            <li><a href="#第二阶段基建搭建与规范制定-infrastructure--standardization">第二阶段：基建搭建与规范制定 (Infrastructure &amp; Standardization)</a></li>
            <li><a href="#第三阶段团队分工与协作流-workflow--cicd">第三阶段：团队分工与协作流 (Workflow &amp; CI/CD)</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#为什么移动端推荐用-jwt-而不是-session">为什么移动端推荐用 JWT 而不是 Session？</a></li>
    <li><a href="#开发过程中有遇到需求变更吗怎么处理的">开发过程中有遇到需求变更吗？怎么处理的？</a></li>
    <li><a href="#你是怎么拆分产品的需求的">你是怎么拆分产品的需求的</a>
      <ol>
        <li><a href="#理解产品目标划分核心模块">理解产品目标，划分核心模块</a></li>
      </ol>
    </li>
    <li><a href="#你们的部署细节是怎样的">你们的部署细节是怎样的？</a>
      <ol>
        <li><a href="#2-具体配置策略">2. 具体配置策略</a>
          <ol>
            <li><a href="#-mysql-配置800mb-方案">🐬 MySQL 配置（800MB 方案）</a></li>
            <li><a href="#-redis-配置256mb-方案">🔴 Redis 配置（256MB 方案）</a></li>
            <li><a href="#-springboot-配置512mb-方案">☕ SpringBoot 配置（512MB 方案）</a></li>
          </ol>
        </li>
        <li><a href="#3-结果验证">3. 结果验证</a></li>
      </ol>
    </li>
    <li><a href="#有经历过接口评审吗">有经历过接口评审吗？</a>
      <ol>
        <li><a href="#设计阶段技术合同评审-design-review">设计阶段：技术合同评审 (Design Review)</a></li>
        <li><a href="#开发阶段代码走查-code-review">开发阶段：代码走查 (Code Review)</a></li>
        <li><a href="#交付阶段业务与验收评审-acceptance-review">交付阶段：业务与验收评审 (Acceptance Review)</a></li>
      </ol>
    </li>
    <li><a href="#es你们是怎么部署的">ES你们是怎么部署的。</a></li>
    <li><a href="#你们是怎么监控大模型-token-用量的">你们是怎么监控大模型 Token 用量的？</a>
      <ol>
        <li><a href="#可能的追问">可能的追问</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E5%AE%9E%E4%B9%A0%E7%BB%8F%E5%8E%86%E8%AF%9D%E6%9C%AF/">实习经历话术</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            会赢的
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-11-28</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 10 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="智识神工实习经历---面试话术指南">智识神工实习经历 - 面试话术指南
</h1><h2 id="你是怎么设计你们的技术选型的">你是怎么设计你们的技术选型的
</h2><p>拿到项目的那几天，先我先进行技术选型，考虑用户的数量，模型的价格，知识库的选型，前端工程的选型，组内分工，前后端对接方式，代码提交方式等等，我让跟我一起去做后端的同事去调研相关技术，当时我跟后端同事对接出来的结果是前期用户量较少，可以选择先用单体架构，然后先使用<strong>SpringBoot</strong>进行项目快速搭建，这块我们都比较熟悉，然后我花了大概一天的时间大概搭出了个框架，包括了统一结果返回，统一的异常处理，讨论出有移动端的存在的话，使用jwt鉴权比较好，AI应用开发方面我比较熟，这块就交给我了，我当时比较熟练使用<strong>SpringAI</strong>去搭建项目，所以就选择了这套技术栈，后面我对整个后端部分进行了分工，我来开发AI应用，另一个同事开发用户模块，我们都会把代码先push到feature分支，然后自己进行单元测试和接口集成测试，测试通过放入test分支，然后写入接口文档，当时我是把接口文档的编写任务交给了另外一个同事，规定了一套标准，接口信息，请求方法，请求路径，样例请求，请求参数，返回参数，样例返回，注意事项等等，pr给前端，前端同学对接完接口后我们把代码放入main分支。</p>
<blockquote>
<p>&ldquo;首先是技术调研。考虑到项目处于 <strong>MVP（最小可行性产品）</strong> 阶段，我们的首要目标是<strong>快速验证业务价值</strong>，同时兼顾成本控制。</p>
<ul>
<li>
<p><strong>架构决策</strong>：虽然微服务很火，但考虑到初期用户量级较小，且团队规模精简，为了避免分布式事务等复杂性带来的开发成本，我拍板决定采用 <strong>SpringBoot 单体架构</strong>。这也符合&rsquo;架构演进&rsquo;的原则，先跑通业务，后期再拆分。</p>
</li>
<li>
<p><strong>核心技术栈</strong>：鉴于业务核心是 AI 对话，而我对 <strong>Spring AI</strong> 生态非常熟悉，它能极大简化 LLM 的接入成本，因此后端定栈为 JDK 17 + SpringBoot 3 + Spring AI。</p>
</li>
<li>
<p><strong>鉴权方案</strong>：考虑到未来有多端适配（移动端/H5）的需求，我选择了无状态的 <strong>JWT + Spring Security</strong> 方案。&rdquo;</p>
</li>
</ul>
</blockquote>
<h4 id="第二阶段基建搭建与规范制定-infrastructure--standardization">第二阶段：基建搭建与规范制定 (Infrastructure &amp; Standardization)
</h4><blockquote>
<p>&ldquo;技术选型确定后，我没有急着写业务代码，而是花了一天时间搭建了<strong>项目脚手架（Scaffolding）</strong>。
这不仅是建个工程，而是制定了整个后端的<strong>开发规范</strong>：</p>
<ol>
<li>
<p><strong>统一响应结构</strong>：封装了全局的 <code>Result&lt;T&gt;</code> 对象和全局异常处理器 (<code>GlobalExceptionHandler</code>)，确保前后端交互的一致性。</p>
</li>
<li>
<p><strong>标准化配置</strong>：集成了 Swagger/Knife4j 自动生成接口文档，确立了 <strong>&lsquo;API First&rsquo;（接口先行）</strong> 的开发模式。</p>
</li>
<li>
<p><strong>模块划分</strong>：虽然是单体，但我按业务领域划分了清晰的包结构（Package Structure），防止代码耦合，为未来可能的微服务拆分留好口子。&rdquo;</p>
</li>
</ol>
</blockquote>
<h4 id="第三阶段团队分工与协作流-workflow--cicd">第三阶段：团队分工与协作流 (Workflow &amp; CI/CD)
</h4><blockquote>
<p>&ldquo;基建完成后，我对后端开发进行了分工：</p>
<ul>
<li>
<p><strong>职责划分</strong>：我负责攻坚核心的 <strong>AI 应用开发（RAG、SSE、Prompt 工程）</strong>；另一位同事负责用户体系等基础业务模块。</p>
</li>
<li>
<p><strong>Git 工作流</strong>：为了保证代码质量，我制定了一套适合我们小团队的 <strong>Gitflow 规范</strong>：</p>
<ul>
<li>
<p>每人基于 <code>feature</code> 分支开发，本地完成<strong>单元测试</strong>。</p>
</li>
<li>
<p>代码合并前必须进行 <code>Self-Review</code>，推送到 <code>test</code> 分支进行接口集成测试。</p>
</li>
<li>
<p>测试通过并更新接口文档后，通过 PR (Pull Request) 流程合并入 <code>main</code> 分支交付前端。</p>
</li>
</ul>
</li>
</ul>
<p>这套流程虽然简单，但有效避免了代码冲突，保证了主分支的稳定性。</p>
</blockquote>
<h2 id="为什么移动端推荐用-jwt-而不是-session">为什么移动端推荐用 JWT 而不是 Session？
</h2><ol>
<li>
<p><strong>客户端兼容性</strong>：Cookie 是浏览器的机制，原生 App（Android/iOS）对 Cookie 的支持不如浏览器友好，需要大量额外的代码去管理 Cookie 的生命周期；而 JWT 通过 HTTP Header 传输，对任何客户端（包括小程序、IoT 设备）都通用。</p>
</li>
<li>
<p><strong>服务端无状态（核心）</strong>：Session 需要服务端存储状态，在高并发场景下会增加服务器内存或 Redis 的压力。JWT 是<strong>无状态</strong>的，用户信息自包含在 Token 中，服务端只需验签，更易于<strong>水平扩展</strong>（扩充机器）。</p>
</li>
</ol>
<h2 id="开发过程中有遇到需求变更吗怎么处理的">开发过程中有遇到需求变更吗？怎么处理的？
</h2><p>“有的，印象最深的是<strong>语音对话功能</strong>的变更。</p>
<p><strong>背景是这样：</strong> 我们的 AI 对话接口原本已经定稿了，只支持文本和图片文件，还有pdf解析。但后来医院那边提出，很多患者打字不方便，强烈要求增加<strong>发送语音</strong>的功能。</p>
<p><strong>我的处理思路是：</strong> 我没有去重写一套‘语音对话’的独立接口，而是把语音视为一种<strong>预处理</strong>步骤。</p>
<ol>
<li>
<p><strong>接入语音识别模型：</strong> 我调研并接入了qwen3的paraformer-realtime-v2的语音转文字API。</p>
</li>
<li>
<p><strong>增加适配层：</strong> 我在 Controller 层新增了一个处理音频的入口。当接收到音频文件（MultipartFile）时，先调用 语音转文字服务把它<strong>转录成 Text</strong>。</p>
</li>
<li>
<p><strong>逻辑复用：</strong> 拿到转录后的 Text 之后，我直接复用了之前写好的 <code>chat(String text)</code> 核心业务方法。</p>
</li>
</ol>
<p><strong>结果：</strong> 这样相当于给核心逻辑加了一个‘翻译官’，底层的 RAG 检索、对话记忆、SSE 流式响应这些复杂逻辑完全不用动，只花了一天时间就平滑支持了语音功能。”</p>
<h2 id="你是怎么拆分产品的需求的">你是怎么拆分产品的需求的
</h2><h3 id="理解产品目标划分核心模块">理解产品目标，划分核心模块
</h3><blockquote>
<p>&ldquo;产品给我们的需求是做一个&rsquo;智能心理健康评估与咨询系统&rsquo;。拿到需求后，我并没有急着写代码，之前听别人分享时说过，开发和架构分析设计应该花费相同的时间，一开始设计的系统的时候下功夫了，后面开发起来才不会一直因为一些细节问题频繁打断开发流程，我们经过仔细分析后，先把它拆成了 5 个核心业务模块：&rdquo;</p>
</blockquote>
<ul>
<li>
<p><strong>用户体系</strong>：患者端 + 医生端，双角色设计。</p>
</li>
<li>
<p><strong>心理量表评估</strong>：标准化量表作答、自动评分与生成报告。</p>
</li>
<li>
<p><strong>AI 智能咨询</strong>：基于大模型的心理对话核心功能。</p>
</li>
<li>
<p><strong>知识库系统</strong>：文档上传、向量化处理、RAG 检索增强。</p>
</li>
<li>
<p><strong>专家对接</strong>：专家信息管理和留言预约功能。</p>
</li>
</ul>
<p>医生端主要负责上传知识库文档，还有管理知识库文档，还有管理心理测评的量纲。</p>
<p>患者端主要负责的是AI对话机器人，知识库搭建，文件和音频的解析等部分，我比较熟悉AI的开发，所以这块我来做，我的让另外一个同事去做一些用户信息校验，还有答题系统的开发，还有把集成测试的工作交给了他。</p>
<p>我们设计了一下后面数据库的表结构，还有一些代码细节，比如返回格式，异常处理，接口文档规范等等。</p>
<h2 id="你们的部署细节是怎样的">你们的部署细节是怎样的？
</h2><blockquote>
<p>&ldquo;为了保证各个服务在共享资源时互不干扰，我们采用了 <strong>Docker Compose</strong> 进行容器化编排。
核心策略是：<strong>在 Docker 层面设置&rsquo;硬上限&rsquo;，在应用层面设置&rsquo;软上限&rsquo;，并预留足够的 Buffer（缓冲空间）。</strong>&rdquo;</p>
</blockquote>
<h3 id="2-具体配置策略">2. 具体配置策略
</h3><p>我主要针对 MySQL、Redis 和 SpringBoot 做了精细化的内存划分：</p>
<h4 id="-mysql-配置800mb-方案">🐬 MySQL 配置（800MB 方案）
</h4><ul>
<li>
<p><strong>Docker 限制（硬限）</strong>：
我们在 <code>docker-compose.yml</code> 中限制了 MySQL 容器最大内存为 <strong>800MB</strong>。如果超过这个值，容器会被宿主机的 OOM Killer 杀掉，保护整机稳定。</p>
</li>
<li>
<p><strong>内部配置（软限）</strong>：
我将 InnoDB 的核心参数 <code>innodb_buffer_pool_size</code> 设置为 <strong>500MB</strong>。</p>
</li>
<li>
<p><strong>设计思考</strong>：</p>
<blockquote>
<p>&ldquo;为什么留了 300MB 空隙？因为 MySQL 除了 Buffer Pool，每个连接线程（Thread Stack）、排序缓冲（Sort Buffer）以及系统库都需要内存。如果 Buffer Pool 占满 800MB，一来并发请求时容器必挂，二来没有空间给操作系统缓存。500MB 存数据，300MB 留给连接和系统，这是经过计算的安全比例。&rdquo;</p>
</blockquote>
</li>
</ul>
<h4 id="-redis-配置256mb-方案">🔴 Redis 配置（256MB 方案）
</h4><ul>
<li>
<p><strong>Docker 限制</strong>：
容器内存限制为 <strong>256MB</strong>。</p>
</li>
<li>
<p><strong>内部配置</strong>：</p>
<ul>
<li>
<p><strong>Max Memory</strong>：在 <code>redis.conf</code> 中设置 <code>maxmemory 200mb</code>。</p>
</li>
<li>
<p><strong>淘汰策略</strong>：配置 <code>maxmemory-policy allkeys-lru</code>。</p>
</li>
</ul>
</li>
<li>
<p><strong>设计思考</strong>：</p>
<blockquote>
<p>&ldquo;Redis 不是只存数据就行的，它还需要内存来处理客户端缓冲区、AOF 重写缓冲以及内存碎片。所以我**预留了 56MB（约 20%）的 Headroom（头部空间）**给这些后台任务。
同时，配合 LRU 策略，一旦数据量达到 200MB，自动剔除最近最少用的数据，保证 Redis 永远不会因为数据写满而撑破 Docker 的 256MB 限制导致崩溃。&rdquo;</p>
</blockquote>
</li>
</ul>
<h4 id="-springboot-配置512mb-方案">☕ SpringBoot 配置（512MB 方案）
</h4><ul>
<li>
<p><strong>JVM 参数</strong>：
设置 <code>-Xms512m -Xmx512m</code>。</p>
</li>
<li>
<p><strong>设计思考</strong>：</p>
<blockquote>
<p>&ldquo;我们将初始堆（Xms）和最大堆（Xmx）设置为相等。
这样做有两个好处：第一，避免 JVM 在运行时动态调整堆大小带来的性能抖动；第二，明确告知 JVM 就用这么多，防止它贪婪申请内存导致容器 OOM。
配合 Docker 容器大约 600MB-700MB 的限制（堆外内存+MetaSpace），对于我们目前的测试量级，服务运行非常稳定。&rdquo;</p>
</blockquote>
</li>
</ul>
<h3 id="3-结果验证">3. 结果验证
</h3><blockquote>
<p>&ldquo;通过这套<strong>内外结合</strong>的配置，在目前的测试环境下，我们从未出现过服务因为 OOM 被 Docker 强杀的情况，资源利用率也控制在非常合理的范围内。&rdquo;</p>
</blockquote>
<h2 id="有经历过接口评审吗">有经历过接口评审吗？
</h2><h3 id="设计阶段技术合同评审-design-review">设计阶段：技术合同评审 (Design Review)
</h3><p>这是你写代码之前的阶段。如果你当时和队友讨论过“接口返回什么格式”、“Redis 存什么数据”，其实就已经在做评审了。</p>
<ul>
<li>
<p><strong>关注点：</strong> 接口路径（URL）、请求参数（Input）、返回结构（Output）。</p>
</li>
<li>
<p><strong>你的情况：</strong> 你确定了用 <code>List</code> 结构存 Redis，用 <code>max_tokens</code> 限制长度等，这些都属于<strong>技术方案评审</strong>。</p>
</li>
</ul>
<h3 id="开发阶段代码走查-code-review">开发阶段：代码走查 (Code Review)
</h3><p>这是在你把代码推送到服务器之前的自查或互查。</p>
<ul>
<li>
<p><strong>关注点：</strong> 内存分配（<code>-Xms</code> / <code>-Xmx</code>）、数据库连接是否关闭、SQL 是否有性能问题。</p>
</li>
<li>
<p><strong>你的情况：</strong> 比如你考虑给 MySQL 分配 800MB 内存，给 Redis 限制 256MB，这就是在进行<strong>资源配额评审</strong>。</p>
</li>
</ul>
<h3 id="交付阶段业务与验收评审-acceptance-review">交付阶段：业务与验收评审 (Acceptance Review)
</h3><p>当时医院的人看到我们生成的结果，发现了问题，我们输出的内容都没有问题，AI 返回的内容过于‘冰冷’且带有‘表格’，不符合患者的心理预期。我们生成的内容甚至直接告诉患者你大概得的是什么病，这是不好的，我们在这个对话中主要做的还是陪伴患者，给患者做心理疏导，最后医生可以通过总结患者对话来总结出患者到底是什么问题，后续进行人工介入。</p>
<h2 id="es你们是怎么部署的">ES你们是怎么部署的。
</h2><p>是的，ES 确实非常吃内存。如果为了我们这个新项目单独部署一套 ES，起步就要占用 4G+ 内存，在我们的共享服务器上不太现实，维护成本也高。</p>
<p>也就是在这个时候，我了解到公司内部（或组内）<strong>已经有一套正在运行的 ES 集群</strong>（可能是给日志系统或者旧搜索业务用的）。</p>
<p>所以我采取了<strong>逻辑隔离，物理共享</strong>的策略：</p>
<ol>
<li>
<p><strong>复用基础设施</strong>：直接连接现有的 ES 集群，省去了部署和运维成本。</p>
</li>
<li>
<p><strong>索引隔离 (Index Isolation)</strong>：我没有把数据混在一起，而是为我们的项目单独建立了专属的索引，命名为 <code>psy_chat_vector_index</code>。</p>
</li>
</ol>
<h2 id="你们是怎么监控大模型-token-用量的">你们是怎么监控大模型 Token 用量的？
</h2><p>我们接入的是阿里云通义千问模型，Token 是按量计费的。测试阶段遇到了几个痛点：不知道每天消耗多少 Token，测试完才发现账单超预期；简单说就是：<strong>看不见、算不清、管不住</strong>。</p>
<p>我对比了几个方案，自己写日志分析太简单但不实时，ELK 功能强但太重运维成本高，云厂商监控开箱即用但贵且和厂商绑定。最终选了 <strong>Prometheus + Grafana</strong>，原因是 Spring Boot Actuator + Micrometer 原生支持，几行配置就能暴露指标；Prometheus 专为时序指标设计，查询性能好；Grafana 图表丰富还能配置告警；而且这是云原生领域的事实标准，学习成本低。</p>
<blockquote>
<p>&ldquo;具体实现分三步：</p>
<p><strong>第一步：埋点采集</strong></p>
<ul>
<li>利用 Spring AI 的 <code>ObservationHandler</code> 机制，在每次 AI 调用完成后采集指标</li>
<li>自定义了核心指标：Token 用量（输入/输出）、请求耗时、并发数、费用估算、错误率</li>
<li>我们的 RAG 系统涉及三类模型，我按模型类型打标签分别统计：<strong>Chat 模型</strong>（对话生成，单价最高）、<strong>Embedding 模型</strong>（向量化，调用频次最高）、<strong>Rerank 模型</strong>（重排序，按次计费）</li>
</ul>
<p><strong>第二步：存储展示</strong></p>
<ul>
<li>Prometheus 每 5 秒抓取一次指标，存储时序数据</li>
<li>Grafana 做可视化 Dashboard，能看到 Token 消耗趋势、响应时间分布、成本曲线</li>
</ul>
<p><strong>第三步：告警通知</strong></p>
<ul>
<li>配置 Alertmanager，Token 超过阈值自动发邮件</li>
<li>用时间窗口告警，比如 <code>increase(ai_token_total[1h]) &gt; 3000</code>，监控每小时增量&rdquo;</li>
</ul>
</blockquote>
<p>在测试环境验证下来，这套方案能清晰看到每次测试的 Token 消耗和费用估算，通过响应时间指标也能快速定位是模型慢还是代码问题。</p>
<h3 id="可能的追问">可能的追问
</h3><p><strong>Q: RAG 系统里哪个模型消耗最大？</strong></p>
<blockquote>
<p>&ldquo;从 Token 数量看，Embedding 模型调用最频繁，因为每次用户提问都要向量化，每次文档入库也要向量化。但从费用看，Chat 模型单价最高，占总成本 60% 以上。Rerank 模型虽然每次调用 Token 不多，但它是按调用次数计费的，也需要单独监控。&rdquo;</p>
</blockquote>
<p><strong>Q: Prometheus 和日志系统有什么区别？</strong></p>
<blockquote>
<p>&ldquo;Prometheus 是<strong>时序数据库</strong>，存的是数值指标，比如&rsquo;发生了多少次、用了多少量&rsquo;；日志系统存的是文本，记录&rsquo;具体发生了什么&rsquo;。两者互补：指标告诉你&rsquo;有问题&rsquo;，日志告诉你&rsquo;什么问题&rsquo;。&rdquo;</p>
</blockquote>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 LuciusWan
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
